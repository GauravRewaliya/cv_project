<%#<%= helper CvHelper %>  
<!-- only defined in controller only  -->


<%#<%= form_with(model: curriculum_vitae  , remote: true )do |form| %>
<%#<%= form_with(model: curriculum_vitae ,html: {target: "_blank"} )do |form| %>
<%= form_with(model: curriculum_vitae )do |form| %>

<% if curriculum_vitae.errors.any? %>
<div class="alert alert-warning" role="alert">
    <!-- <div style="color: #b53535"> -->
      <h2>
        <%= pluralize(curriculum_vitae.errors.count, "error" ) %> errors found , cant be save
      </h2>

      <ul>
        <% curriculum_vitae.errors.each do |error| %>
          <li>
            <%= error.full_message %>
          </li>
          <% end %>
      </ul>
    </div>
    <% end %>


      <div>
        <%= form.label "Candidate ID" , style: "display: block" ,class: "text-white" %>
          <%= collection_select( nil , :candidate_id, Candidate.all, :id, :name, { include_blank: true ,selected:
            @curriculum_vitae.candidate&.id} ,{required: true})%>
      </div>



      <div>
        <%= form.label "Role" , style: "display: block" ,class: "text-white" %>
          <%= form.text_field :objective ,style: "width: 100%;text-align: center;" ,class: "form-control" %>
      </div>
      <div>
        <%= form.label "Profile Description" , style: "display: block" ,class: "text-white" %>
          <%= form.text_area :profile_desc ,style: "width: 100%;text-align: center;" ,class: "form-control" %>
      </div>

      <div>
        <%= form.label "Experience" , style: "display: block" ,class: "text-white" %>
          <%= form.number_field :experience ,style: "width: 100%;text-align: center;" ,class: "form-control" %>
      </div>

      <div>
        <%= form.label "Core Skill" , style: "display: block" ,class: "text-white" %>
          <!-- <%= collection_select( nil , :core_skill_id, TechStack.all, :id, :title, { include_blank: true ,selected: curriculum_vitae.core_skill&.id } )%> -->

          <%= form.fields_for :curriculum_vitae_core_tech_attributes, curriculum_vitae.curriculum_vitae_core_tech do
            |cs| %>
            <%= cs.collection_select :tech_stack_id, TechStack.core_skills.order(:title), :id, :title, { include_blank: true } ,{
              id: "core_tech_select_id" }%>
              <% end %>
      </div>
      <!-- skills ++ -->
      <div>
        <%= form.label :supportive_skills, style: "display: block" ,class: "text-white" %>
          <%= form.collection_select(:supportive_skill_ids, TechStack.supportive_skills, :id, :title , {}, { multiple: true,
            include_blank: false ,id: 'supportive_skill' }) %>
            <script>
              new MultiSelectTag('supportive_skill')  // id
            </script>
      </div>
          <!-- normal multipal select  -->
      <!-- <div>
  <%= form.label "Projects", style: "display: block" ,class: "text-white"%>
  <%= form.collection_select(:project_ids, Project.all, :id, :title , {}, { multiple: true,  include_blank: false ,id: 'selectgr' }) %>
<script>
  new MultiSelectTag('selectgr')  // id
</script>
  </div> -->

          <!-- group by select by manual  -->
      <div>
        <%= form.label "Projects", style: "display: block" ,class: "text-white"%>
        <!-- <select multiple name="curriculum_vitae[project_ids][]" > -->
        <select multiple name="curriculum_vitae[project_ids][]" class="selectpicker show-menu-arrow form-control" data-live-search="true">
          <% TechStack.core_skills.each do |core_skill|%>
            <% if core_skill.projects.count> 0 %>
              <optgroup label=<%=core_skill.title%>>
                <% core_skill.projects.each do |project|%>
                  <option value=<%=project.id %>> <%= project.title%>
                  </option>
                  <%end%>
              </optgroup>
            <%end%>
          <%end%>
        </select>
      </div>
      
      <!-- by using grouped_options_for_select  // at hepler method -->
      <div>
        <%= form.label "Projects", style: "display: block" ,class: "text-white"%>
        <%= form.select(:project_ids, grouped_options_for_select(helper_grouped_projects_options), {}, { multiple: true,  include_blank: false ,id: 'selectgr' }) %>
      </div>
      
      <!-- https://developer.snapappointments.com/bootstrap-select/examples/ -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
      <style>
        .bootstrap-select .dropdown-menu {
          min-width: auto;
          }
      </style>

      <div>
        <%= form.label "select profile image" , class: "text-white" %>
          <%= form.file_field :image ,class: "form-control" %>
      </div>

      <!-- <div>
    <%= form.label "Layout", style: "display: block" ,class: "text-white"%>
    <%#<%= collection_select( nil , :template_format_id, TemplateFormat.all, :id, :name, { include_blank: true,selected: @curriculum_vitae.template_format&.id} )%>
  </div> -->

      <div>
        <%= form.label "Layout" , style: "display: block" ,class: "text-white" %>
          <% template_files=Dir.glob(Rails.root.join('app', 'views' , 'HTML_templates' , '*.html.erb' )) %>
            <% @template_options=template_files.map { |file| File.basename(file, '.html.erb' ) }%>

              <select required name="curriculum_vitae[template_name]">
                <option value="">select any template</option>
                <% @template_options.each do |template_option| %>
                  <option value="<%= template_option %>">
                    <%= template_option.titleize %>
                  </option>
                  <% end %>

              </select>
      </div>

      <%= form.submit class: 'btn-primary' %>
        <% end%>